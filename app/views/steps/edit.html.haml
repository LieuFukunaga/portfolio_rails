.steps-edit
  .steps-edit__goal
    .steps-edit__goal__image
      .goal-image-box
        - if @goal.image.attached?
          = image_tag @goal.image.variant(combine_options:{resize:"300x300^",crop:"300x300+0+0",gravity: :center}).processed
        - else
          %i.fas.fa-flag-checkered.no-image
    .steps-edit__goal__contents
      .contents-box
        .contents
          .steps-edit__goal__contents__title
            = @goal.title
          .steps-edit__goal__contents__status
            = @goal.status_i18n
    .steps-edit__goal__date
      = "予定日時：#{@goal.date.strftime("%Y/%m/%d %H:%M")}"
    .steps-edit__goal__category
      - if @categories.length != 0
        カテゴリ一覧：
        .category-box
          - @categories.each do |category|
            .steps-edit__goal-categories
              = link_to "#{category.category_name}", category_path(category)
      - else
        カテゴリは設定されていません
    .steps-edit-links
      = render partial: "layouts/return-to-goals-show"
      = render partial: "layouts/return-to-lists-show"
      = render partial: "layouts/return-to-root"

  .steps-edit__steps
    = form_with model: @step, url: list_goal_step_path(@list, @goal, @step), local: true do |f|
      - @steps.each.with_index do |step, index|
        -# 編集対象がstep_2のときstep_1, step_3のときstep_1,2
        - if @step.id > step.id
          -# step_3以外の場合
          - if index != 2
            .steps.half_opacity
              .left-box
                .steps__image
                  - if step.step_image.attached?
                    = image_tag step.step_image.variant(combine_options:{resize:"220x220^",crop:"220x220+0+0",gravity: :center}).processed
                  - else
                    %i.fas.fa-shoe-prints.no-image
              .right-box
                .flex-box
                  .flex--center
                    .steps__title
                      = step.title
                    .steps__status
                      = step.status_i18n
        - elsif @step.id == step.id
          -# step＝編集対象の場合
          - if index != 2
            -# step_1または2を編集する場合
            .steps
              .form--left
                .flex--center
                  .steps-edit__image
                    .image-box
                      - if @step.step_image.attached?
                        .current-image
                          .image--flex
                            = image_tag @step.step_image.variant(combine_options:{resize:"100x100^",crop:"100x100+0+0",gravity: :center}).processed
                            %br
                            = link_to "元の画像を削除", destroy_image_list_goal_step_path(@list, @goal, @step), method: :delete , class: "steps-edit__delete-current-image-btn"
                      .new-image
                        .image--flex
                  .steps-edit__icons
                    .steps-edit__icons__upload-image
                      = f.label :step_image, class: "steps-edit__upload-label" do
                        %i.fa.fa-camera
                        = f.file_field :step_image, class: "steps-edit__file-field"
                    .steps-edit__icons__remove-image
                      %i.fas.fa-trash#steps-edit__remove-preview-btn
              .form--right
                .steps-edit__fields
                  .fields--flex
                    .title-field
                      = f.text_field :title
                    .status-field
                      = f.select :status, Goal.statuses_i18n.invert, {}, {class: 'steps-edit__select-step-status'}
                  .steps-edit__submit-btn
                    = f.submit "保存"
          - else
            -# step_3を編集する場合
            .anchor-step
              .form--left
                .flex--center
                  .steps-edit__image
                    .image-box
                      - if @step.step_image.attached?
                        .current-image
                          .image--flex
                            = image_tag @step.step_image.variant(combine_options:{resize:"100x100^",crop:"100x100+0+0",gravity: :center}).processed
                            %br
                            = link_to "元の画像を削除", destroy_image_list_goal_step_path(@list, @goal, @step), method: :delete , class: "steps-edit__delete-current-image-btn"
                      .new-image
                        .image--flex
                  .steps-edit__icons
                    .steps-edit__icons__upload-image
                      = f.label :step_image, class: "steps-edit__upload-label" do
                        %i.fa.fa-camera
                        = f.file_field :step_image, class: "steps-edit__file-field"
                    .steps-edit__icons__remove-image
                      %i.fas.fa-trash#steps-edit__remove-preview-btn
              .form--right
                .steps-edit__fields
                  .fields--flex
                    .title-field
                      = f.text_field :title
                    .status-field
                      = f.select :status, Goal.statuses_i18n.invert, {}, {class: 'steps-edit__select-step-status'}
                  .steps-edit__submit-btn
                    = f.submit "保存"
        - else
          -# 編集対象がstep_1のときstep_1,2 / step_2のときstep_3
          - if index != 2
            -# step_3以外の場合
            .steps.half_opacity
              .left-box
                .steps__image
                  - if step.step_image.attached?
                    = image_tag step.step_image.variant(combine_options:{resize:"220x220^",crop:"220x220+0+0",gravity: :center}).processed
                  - else
                    %i.fas.fa-shoe-prints.no-image
              .right-box
                .flex-box
                  .flex--center
                    .steps__title
                      = step.title
                    .steps__status
                      = step.status_i18n
          - else
            -# step_3の場合
            .anchor-step.half_opacity
              .left-box
                .anchor-step__image
                  - if step.step_image.attached?
                    = image_tag step.step_image.variant(combine_options:{resize:"220x220^",crop:"220x220+0+0",gravity: :center}).processed
                  - else
                    %i.fas.fa-shoe-prints.no-image
              .right-box
                .flex-box
                  .flex--center
                    .steps__title
                      = step.title
                    .steps__status
                      = step.status_i18n

  .steps-edit__actions