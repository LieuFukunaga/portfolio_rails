.goals-new
  .goals-new__form
    -# このページのフォームはすべてこのform要素に内包されなければならない
    = form_with model:@goal, url: list_goals_path(:id), id: "new-task-form", local: true do |f|
      .new-task-form
        -# セクション：goal
        .new-task-form__goal
          .new-task-form__goal__image
            .new-task-form__goal__image__preview
              -# 以下に画像プレビューをappend
          %br
          .new-task-form__goal__fields
            .new-task-form__goal__fields__image
              .new-task-form__goal__fields__image__upload
                = f.label :image, class: "new-task-form__goal__upload-label" do
                  %i.fa.fa-camera
                  = f.file_field :image, class: "new-task-form__goal__file-field"
              .new-task-form__goal__fields__image__remove
                %i.fas.fa-trash.new-task__goal__remove-preview-btn
            .new-task-form__goal__fields__text
              = f.text_field :title, id: "new-task-form__goal__text-field", value: "goal", placeholder: "20文字以内"
            .new-task-form__goal__fields__datetime
              = f.label :date, "予定日"
              %br
              = f.datetime_select :date, {use_month_numbers: true, default: Time.now + 1.hour, datetime_separator: '<br><label class="datetime-selector">予定時刻<br></label>', minute_step: 5}
            = f.hidden_field :list_id, value: @list.id
            = f.hidden_field :user_id, value: current_user.id
          -# セクション：goal(カテゴリ)
          .new-task-form__category
            - if Category.where(user_id: current_user.id).length != 0
              .new-task-form__category__check-boxes
                = button_tag "カテゴリを選択", type: "button", id: "modal-fadein-btn"
                .new-task-form__category__check-boxes__options-box
                  .options
                    = f.collection_check_boxes(:category_ids, Category.where(user_id: current_user.id), :id, :category_name, include_hidden: false) do |c|
                      .categories
                        = c.label {c.check_box}
                        = c.label {c.text}
                  .close-btn
                    = button_tag "閉じる", type: "button", id: "modal-fadeout-btn"
            .new-task-form__category__create-category-form
              = f.label "新規カテゴリを作成"
              %br
              = f.fields_for :categories do |c|
                = c.text_field :category_name, placeholder: "複数の場合はspaceまたはカンマで区切って下さい", id:"create-category-form"
                = c.hidden_field :user_id, value: current_user.id, class: "hidden-field__category__user-id"
          .new-task-form__submit-btn
            = f.submit "保存"
          .new-task-form__links
            = render partial: "layouts/return-to-lists-show"
            = render partial: "layouts/return-to-root"

        -# セクション：step
        .new-task-form__steps
          = f.fields_for :steps do |s|
            - 3.times.with_index do |t, index|
              - if index % 3 != 2
                .new-task-form__steps__fields
                  .new-task-form__steps__fields__image
                    .new-task-form__steps__fields__image__preview{class: "step-previews_#{index}"}
                      -# 以下に画像プレビューをappend
                    .new-task-form__steps__fields__image__icons
                      .new-task-form__steps__fields__image__icons__upload
                        = s.label :step_image, class: "new-task-form__steps__upload-label", id: "steps-upload-label_#{index}", for: "goal_steps_attributes_#{index}_step_image" do
                          %i.fa.fa-camera
                          = s.file_field :step_image, class: "new-task-form__steps__file-field steps-file-field_#{index}", data:{step_index: index}, name: "goal[steps_attributes][#{index}][step_image]", id: "goal_steps_attributes_#{index}_step_image"
                      .new-task-form__steps__fields__image__icons__remove
                        %i.fas.fa-trash.new-task-form__steps__remove-preview-btn{data:{step_index: index}}
                  .new-task-form__steps__fields__text
                    = s.text_field :title, class:"new-task-form__steps__text-field", id: "new-task-form__step-#{index}", value: "steps", name: "goal[steps_attributes][#{index}][title]", placeholder: "20文字以内"
                  .new-task-form__steps__hidden-fields
                    = s.hidden_field :user_id, value: current_user.id, class: "new-task-form__steps__hidden-field__user-id", id: "goal_steps_attributes_#{index}_user_id", name: "goal[steps_attributes][#{index}][user_id]"
                    = s.hidden_field :list_id, value: @list.id, class: "new-task-form__steps__hidden-field__list-id", id: "goal_steps_attributes_#{index}_list_id", name: "goal[steps_attributes][#{index}][list_id]"
              - else
                .new-task-form__anchor-step__fields
                  .new-task-form__anchor-step__fields__image
                    .new-task-form__anchor-step__fields__image__preview{class: "step-previews_#{index}"}
                      -# 以下に画像プレビューをappend
                    .new-task-form__anchor-step__fields__image__icons
                      .new-task-form__anchor-step__fields__image__icons__upload
                        = s.label :step_image, class: "new-task-form__anchor-step__upload-label", id: "steps-upload-label_#{index}", for: "goal_steps_attributes_#{index}_step_image" do
                          %i.fa.fa-camera
                          = s.file_field :step_image, class: "new-task-form__anchor-step__file-field steps-file-field_#{index}", data:{step_index: index}, name: "goal[steps_attributes][#{index}][step_image]", id: "goal_steps_attributes_#{index}_step_image"
                      .new-task-form__anchor-step__fields__image__icons__remove
                        %i.fas.fa-trash.new-task-form__anchor-step__remove-preview-btn{data:{step_index: index}}
                  .new-task-form__anchor-step__fields__text
                    = s.text_field :title, class:"new-task-form__anchor-step__text-field", id: "new-task-form__step-#{index}", value: "steps", name: "goal[steps_attributes][#{index}][title]", placeholder: "20文字以内"
                  .new-task-form__anchor-step__hidden-fields
                    = s.hidden_field :user_id, value: current_user.id, class: "new-task-form__anchor-step__hidden-field__user-id", id: "goal_steps_attributes_#{index}_user_id", name: "goal[steps_attributes][#{index}][user_id]"
                    = s.hidden_field :list_id, value: @list.id, class: "new-task-form__anchor-step__hidden-field__list-id", id: "goal_steps_attributes_#{index}_list_id", name: "goal[steps_attributes][#{index}][list_id]"


        -# セクション：action
        .new-task-form__actions
          = f.fields_for :actions do |a|
            - 9.times.with_index do |t, index|
              - if index != 2 && index != 5
                .new-task-form__actions__fields
                  .new-task-form__actions__fields--left
                    .new-task-form__actions__fields__image
                      .new-task-form__actions__fields__image__preview{class: "action-previews_#{index}"}
                        -# 以下に画像プレビューをappend

                  .new-task-form__actions__fields--right
                    .right-form-box
                      .new-task-form__actions____text-field
                        = a.text_field :title, class:"new-task-form__actions__text-field", id: "new-task-form__action-#{index}", value: "actions", name: "goal[actions_attributes][#{index}][title]", placeholder: "20文字以内"
                      .new-task-form__actions__icons
                        .new-task-form__actions__icons__upload
                          = a.label :action_image, class: "new-task-form__actions__upload-label", id: "actions-upload-label_#{index}", for: "goal_actions_attributes_#{index}_action_image" do
                            %i.fa.fa-camera
                            = a.file_field :action_image, class: "new-task-form__actions__file-field actions-file-field_#{index}", data:{action_index: index}, name: "goal[actions_attributes][#{index}][action_image]", id: "goal_actions_attributes_#{index}_action_image"
                        .new-task-form__actions__icons__remove
                          %i.fas.fa-trash.new-task-form__actions__remove-preview-btn{data:{action_index: index}}
                  .new-task-form__actions__hidden-fields
                    = a.hidden_field :user_id, value: current_user.id, class: "new-task-form__actions__hidden-field__user-id", id: "goal_actions_attributes_#{index}_user_id", name: "goal[actions_attributes][#{index}][user_id]"
                    = a.hidden_field :list_id, value: @list.id, class: "new-task-form__actions__hidden-field__list-id", id: "goal_actions_attributes_#{index}_list_id", name: "goal[actions_attributes][#{index}][list_id]"
              - else
                .new-task-form__anchor-actions__fields
                  .new-task-form__anchor-actions__fields--left
                    .new-task-form__anchor-actions__fields__image
                      .new-task-form__anchor-actions__fields__image__preview{class: "action-previews_#{index}"}
                        -# 以下に画像プレビューをappend

                  .new-task-form__anchor-actions__fields--right
                    .right-form-box
                      .new-task-form__anchor-actions____text-field
                        = a.text_field :title, class:"new-task-form__anchor-actions__text-field", id: "new-task-form__action-#{index}", value: "actions", name: "goal[actions_attributes][#{index}][title]", placeholder: "20文字以内"
                      .new-task-form__anchor-actions__icons
                        .new-task-form__anchor-actions__icons__upload
                          = a.label :action_image, class: "new-task-form__anchor-actions__upload-label", id: "actions-upload-label_#{index}", for: "goal_actions_attributes_#{index}_action_image" do
                            %i.fa.fa-camera
                            = a.file_field :action_image, class: "new-task-form__anchor-actions__file-field actions-file-field_#{index}", data:{action_index: index}, name: "goal[actions_attributes][#{index}][action_image]", id: "goal_actions_attributes_#{index}_action_image"
                        .new-task-form__anchor-actions__icons__remove
                          %i.fas.fa-trash.new-task-form__anchor-actions__remove-preview-btn{data:{action_index: index}}
                  .new-task-form__anchor-actions__hidden-fields
                    = a.hidden_field :user_id, value: current_user.id, class: "new-task-form__anchor-actions__hidden-field__user-id", id: "goal_actions_attributes_#{index}_user_id", name: "goal[actions_attributes][#{index}][user_id]"
                    = a.hidden_field :list_id, value: @list.id, class: "new-task-form__anchor-actions__hidden-field__list-id", id: "goal_actions_attributes_#{index}_list_id", name: "goal[actions_attributes][#{index}][list_id]"